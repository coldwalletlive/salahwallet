<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cold Wallet Login</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1a2a3a, #0d1b2a);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .login-box, .update-box {
      background: rgba(20, 30, 40, 0.95);
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      width: 100%;
      max-width: 350px;
      text-align: center;
    }
    .login-box h2, .update-box h2 {
      color: #4fc3f7;
      margin-bottom: 25px;
    }
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }
    .form-group label {
      color: #b3e5fc;
      font-size: 14px;
      display: block;
      margin-bottom: 6px;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 14px;
      box-sizing: border-box;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #4fc3f7;
    }
    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #4fc3f7, #29b6f6);
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      color: #0d1b2a;
      transition: all 0.3s;
    }
    button:hover {
      background: linear-gradient(135deg, #29b6f6, #039be5);
    }
    .hidden {
      display: none;
    }
    .qr-code {
      background: white;
      padding: 10px;
      border-radius: 6px;
      margin: 10px auto;
      width: 150px;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .qr-code img {
      max-width: 100%;
      max-height: 100%;
    }
    .info-text {
      color: #b3e5fc;
      font-size: 12px;
      margin-top: 10px;
    }
    .error-message {
      color: #ff6b6b;
      font-size: 12px;
      margin-top: 5px;
      display: none;
    }
    .credentials-info {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 6px;
      margin-top: 20px;
      font-size: 12px;
      color: #b3e5fc;
    }
  </style>
</head>
<body>
  <!-- صفحة تسجيل الدخول -->
  <div class="login-box" id="loginPage">
    <h2><i class="fas fa-wallet"></i> Cold Wallet</h2>
    <form id="loginForm">
      <div class="form-group">
        <label><i class="fas fa-user"></i> Username</label>
        <input type="text" id="loginUsername" placeholder="Enter your username" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-lock"></i> Password</label>
        <input type="password" id="loginPassword" placeholder="Enter your password" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-shield-alt"></i> 2FA Code</label>
        <input type="text" id="login2FA" placeholder="Enter 2FA code" required>
      </div>
      <button type="submit"><i class="fas fa-sign-in-alt"></i> Login</button>
    </form>
    
    <div class="credentials-info">
      <strong>Default Login Credentials:</strong><br>
      Username: <code>admin</code><br>
      Password: <code>admin123</code><br>
      2FA Code: <code>123456</code> (for testing)
    </div>
  </div>

  <!-- صفحة تحديث المعلومات -->
  <div class="update-box hidden" id="updatePage">
    <h2><i class="fas fa-user-edit"></i> Update Your Information</h2>
    <form id="updateForm">
      <div class="form-group">
        <label><i class="fas fa-user"></i> New Username</label>
        <input type="text" id="updateUsername" placeholder="Choose a new username" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-lock"></i> New Password</label>
        <input type="password" id="updatePassword" placeholder="Choose a new password" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-lock"></i> Confirm New Password</label>
        <input type="password" id="updateConfirmPassword" placeholder="Confirm your new password" required>
        <div class="error-message" id="passwordError">Passwords do not match</div>
      </div>
      <div class="form-group">
        <label><i class="fas fa-shield-alt"></i> Security Question</label>
        <select id="securityQuestion" required>
          <option value="">Select a security question</option>
          <option value="pet">What is the name of your first pet?</option>
          <option value="city">In which city were you born?</option>
          <option value="school">What was the name of your elementary school?</option>
        </select>
      </div>
      <div class="form-group">
        <label><i class="fas fa-key"></i> Security Answer</label>
        <input type="text" id="securityAnswer" placeholder="Enter your answer" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-mobile-alt"></i> Google Authenticator Setup</label>
        <div class="qr-code">
          <!-- هنا سيتم عرض QR Code لتطبيق Google Authenticator -->
          <div id="qrCodePlaceholder">QR Code Placeholder</div>
        </div>
        <input type="text" id="gauthCode" placeholder="Enter Google Authenticator code" required>
        <div class="info-text">Scan the QR code with Google Authenticator app</div>
      </div>
      <button type="submit"><i class="fas fa-check"></i> Complete Update</button>
    </form>
  </div>

  <script>
    // بيانات المستخدمين المخزنة محلياً
    let users = JSON.parse(localStorage.getItem('coldWalletUsers')) || {};
    let ipChangeTime = localStorage.getItem('ipChangeTime');
    let currentIP = localStorage.getItem('currentIP');

    // معلومات الدخول الافتراضية
    const defaultCredentials = {
      username: 'admin',
      password: 'admin123',
      twoFA: '123456'
    };

    // تهيئة المستخدم الافتراضي إذا لم يكن موجوداً
    if (!users[defaultCredentials.username]) {
      users[defaultCredentials.username] = {
        password: defaultCredentials.password,
        needsUpdate: true, // يحتاج لتحديث المعلومات
        securityQuestion: '',
        securityAnswer: '',
        gauthSecret: 'default123',
        registrationDate: new Date().toISOString()
      };
      localStorage.setItem('coldWalletUsers', JSON.stringify(users));
    }

    // عناصر DOM
    const loginPage = document.getElementById('loginPage');
    const updatePage = document.getElementById('updatePage');
    const loginForm = document.getElementById('loginForm');
    const updateForm = document.getElementById('updateForm');
    const passwordError = document.getElementById('passwordError');
    const updatePassword = document.getElementById('updatePassword');
    const updateConfirmPassword = document.getElementById('updateConfirmPassword');

    // التحقق من تغيير الـ IP
    function checkIPChange() {
      const newIP = '192.168.1.1'; // مثال
      
      if (currentIP && currentIP !== newIP) {
        localStorage.setItem('ipChangeTime', new Date().getTime());
        localStorage.setItem('currentIP', newIP);
        return true;
      } else if (!currentIP) {
        localStorage.setItem('currentIP', newIP);
      }
      return false;
    }

    // التحقق من الوقت المتبقي بعد تغيير الـ IP
    function checkTimeRemaining() {
      if (ipChangeTime) {
        const now = new Date().getTime();
        const timeDiff = now - parseInt(ipChangeTime);
        const hours48 = 48 * 60 * 60 * 1000;
        
        if (timeDiff < hours48) {
          const remainingTime = hours48 - timeDiff;
          const remainingHours = Math.floor(remainingTime / (60 * 60 * 1000));
          const remainingMinutes = Math.floor((remainingTime % (60 * 60 * 1000)) / (60 * 1000));
          
          alert(`You changed your IP recently. Please wait ${remainingHours} hours and ${remainingMinutes} minutes before logging in again.`);
          return false;
        } else {
          localStorage.removeItem('ipChangeTime');
        }
      }
      return true;
    }

    // توليد مفتاح Google Authenticator
    function generateGoogleAuthSecret() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
      let secret = '';
      for (let i = 0; i < 16; i++) {
        secret += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return secret;
    }

    // التحقق من رمز Google Authenticator
    function verifyGoogleAuthCode(secret, code) {
      // للاختبار، نقبل أي رمز مكون من 6 أرقام
      return code.length === 6 && /^\d+$/.test(code);
    }

    // التحقق من تطابق كلمات المرور أثناء التحديث
    updateConfirmPassword.addEventListener('input', function() {
      if (updatePassword.value !== updateConfirmPassword.value) {
        passwordError.style.display = 'block';
      } else {
        passwordError.style.display = 'none';
      }
    });

    // معالجة تسجيل الدخول
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // التحقق من تغيير الـ IP
      if (checkIPChange()) {
        alert('IP change detected. You will need to wait 48 hours before logging in.');
        return;
      }
      
      // التحقق من الوقت المتبقي بعد تغيير الـ IP
      if (!checkTimeRemaining()) {
        return;
      }
      
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      const twoFACode = document.getElementById('login2FA').value;
      
      // التحقق من بيانات المستخدم الافتراضية
      if (username === defaultCredentials.username && 
          password === defaultCredentials.password && 
          twoFACode === defaultCredentials.twoFA) {
        
        // إذا كان المستخدم يحتاج لتحديث المعلومات
        if (users[username] && users[username].needsUpdate) {
          // الانتقال إلى صفحة تحديث المعلومات
          loginPage.classList.add('hidden');
          updatePage.classList.remove('hidden');
          
          // توليد QR Code جديد لـ Google Authenticator
          const secret = generateGoogleAuthSecret();
          document.getElementById('qrCodePlaceholder').innerHTML = `New Secret: ${secret}`;
        } else {
          alert('Login successful!');
        }
      } else {
        alert('Invalid username, password or 2FA code. Please try again.');
      }
    });

    // معالجة تحديث المعلومات
    updateForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // التحقق من تطابق كلمات المرور
      if (updatePassword.value !== updateConfirmPassword.value) {
        alert('Passwords do not match. Please try again.');
        return;
      }
      
      const newUsername = document.getElementById('updateUsername').value;
      const newPassword = document.getElementById('updatePassword').value;
      const securityQuestion = document.getElementById('securityQuestion').value;
      const securityAnswer = document.getElementById('securityAnswer').value;
      const gauthCode = document.getElementById('gauthCode').value;
      
      // التحقق من رمز Google Authenticator
      const secret = generateGoogleAuthSecret();
      if (!verifyGoogleAuthCode(secret, gauthCode)) {
        alert('Invalid Google Authenticator code. Please try again.');
        return;
      }
      
      // تحديث بيانات المستخدم
      delete users[defaultCredentials.username]; // حذف المستخدم الافتراضي
      
      users[newUsername] = {
        password: newPassword,
        securityQuestion: securityQuestion,
        securityAnswer: securityAnswer,
        gauthSecret: secret,
        needsUpdate: false, // لم يعد يحتاج لتحديث
        registrationDate: new Date().toISOString()
      };
      
      localStorage.setItem('coldWalletUsers', JSON.stringify(users));
      
      alert('Information updated successfully! Please login with your new credentials.');
      
      // العودة إلى صفحة تسجيل الدخول
      updatePage.classList.add('hidden');
      loginPage.classList.remove('hidden');
      
      // تنظيف النموذج
      updateForm.reset();
      document.getElementById('loginUsername').value = '';
      document.getElementById('loginPassword').value = '';
      document.getElementById('login2FA').value = '';
    });

    // التحقق الأولي من تغيير الـ IP عند تحميل الصفحة
    checkIPChange();
  </script>
</body>
</html>

