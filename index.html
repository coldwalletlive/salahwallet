<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cold Wallet Login</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1a2a3a, #0d1b2a);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .login-box, .update-box {
      background: rgba(20, 30, 40, 0.95);
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      width: 100%;
      max-width: 350px;
      text-align: center;
    }
    .login-box h2, .update-box h2 {
      color: #4fc3f7;
      margin-bottom: 25px;
    }
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }
    .form-group label {
      color: #b3e5fc;
      font-size: 14px;
      display: block;
      margin-bottom: 6px;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 14px;
      box-sizing: border-box;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #4fc3f7;
    }
    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #4fc3f7, #29b6f6);
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      color: #0d1b2a;
      transition: all 0.3s;
    }
    button:hover {
      background: linear-gradient(135deg, #29b6f6, #039be5);
    }
    .hidden { display: none; }
    .qr-code {
      background: white;
      padding: 10px;
      border-radius: 6px;
      margin: 10px auto;
      width: 150px;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-size: 12px;
      text-align: center;
    }
    .info-text { color: #b3e5fc; font-size: 12px; margin-top: 10px; }
    .error-message { color: #ff6b6b; font-size: 12px; margin-top: 5px; display: none; }
    .success-message {
      background: rgba(76, 175, 80, 0.2);
      border: 1px solid rgba(76, 175, 80, 0.5);
      padding: 10px; border-radius: 6px; margin-bottom: 20px; color: #4caf50; font-size: 12px;
    }
    .security-notice {
      background: rgba(255,193,7,0.1);
      border: 1px solid rgba(255,193,7,0.3);
      padding: 10px; border-radius: 6px; margin-top: 15px; font-size: 11px; color: #ffd54f;
    }
    .lock-message {
      background: rgba(244,67,54,0.2);
      border: 1px solid rgba(244,67,54,0.5);
      padding: 20px; border-radius: 6px; text-align: center; color: #f44336;
    }
  </style>
</head>
<body>
  <!-- صفحة تسجيل الدخول -->
  <div class="login-box" id="loginPage">
    <h2><i class="fas fa-wallet"></i> Cold Wallet</h2>
    <form id="loginForm">
      <div class="form-group">
        <label><i class="fas fa-user"></i> Username</label>
        <input type="text" id="loginUsername" placeholder="Enter your username" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-lock"></i> Password</label>
        <input type="password" id="loginPassword" placeholder="Enter your password" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-shield-alt"></i> 2FA Code</label>
        <input type="text" id="login2FA" placeholder="Enter 2FA code" required>
      </div>
      <button type="submit"><i class="fas fa-sign-in-alt"></i> Login</button>
    </form>
    
    <div class="security-notice">
      <i class="fas fa-shield-alt"></i> Secure authentication required
    </div>
  </div>

  <!-- صفحة تحديث المعلومات -->
  <div class="update-box hidden" id="updatePage">
    <h2><i class="fas fa-user-edit"></i> Security Update Required</h2>
    
    <div class="success-message">
      <i class="fas fa-check-circle"></i> Initial authentication successful! Please update your security information.
    </div>
    
    <form id="updateForm">
      <div class="form-group">
        <label><i class="fas fa-user"></i> New Username</label>
        <input type="text" id="updateUsername" placeholder="Choose a new username" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-lock"></i> New Password</label>
        <input type="password" id="updatePassword" placeholder="Choose a new password" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-lock"></i> Confirm New Password</label>
        <input type="password" id="updateConfirmPassword" placeholder="Confirm your new password" required>
        <div class="error-message" id="passwordError">Passwords do not match</div>
      </div>
      <div class="form-group">
        <label><i class="fas fa-shield-alt"></i> Security Question</label>
        <select id="securityQuestion" required>
          <option value="">Select a security question</option>
          <option value="pet">What is the name of your first pet?</option>
          <option value="city">In which city were you born?</option>
          <option value="school">What was the name of your elementary school?</option>
        </select>
      </div>
      <div class="form-group">
        <label><i class="fas fa-key"></i> Security Answer</label>
        <input type="text" id="securityAnswer" placeholder="Enter your answer" required>
      </div>
      <div class="form-group">
        <label><i class="fas fa-mobile-alt"></i> Google Authenticator Setup</label>
        <div class="qr-code">
          <div id="qrCodePlaceholder">
            <strong>Google Authenticator</strong><br>
            Secret: <span id="secretKey"></span><br>
            <small>Enter this in your app</small>
          </div>
        </div>
        <input type="text" id="gauthCode" placeholder="Enter 6-digit code from app" required>
        <div class="info-text">Download Google Authenticator app and add this secret key</div>
      </div>
      <button type="submit"><i class="fas fa-check"></i> Complete Security Setup</button>
    </form>
  </div>

  <!-- صفحة الحظر -->
  <div class="login-box hidden" id="lockPage">
    <div class="lock-message">
      <i class="fas fa-lock fa-3x"></i>
      <h2>System Temporarily Locked</h2>
      <p id="lockTimer">System locked for 48 hours due to security changes</p>
      <div class="info-text">
        Security policy: System locks for 48 hours after IP and credential changes
      </div>
    </div>
  </div>

  <script>
    // معلومات الدخول السرية (مشفرة)
    const encryptedCredentials = {
      username: 'YWRtaW4=', // 'admin' in Base64
      password: 'YWRtaW4xMjM=', // 'admin123' in Base64  
      twoFA: 'MTIzNDU2' // '123456' in Base64
    };

    // دالة فك التشفير
    function decrypt(data) {
      return atob(data);
    }

    // بيانات التطبيق
    let users = JSON.parse(localStorage.getItem('coldWalletUsers')) || {};
    let securityLog = JSON.parse(localStorage.getItem('securityLog')) || [];
    let currentIP = localStorage.getItem('currentIP') || '192.168.1.1';

    // عناصر DOM
    const loginPage = document.getElementById('loginPage');
    const updatePage = document.getElementById('updatePage');
    const lockPage = document.getElementById('lockPage');
    const loginForm = document.getElementById('loginForm');
    const updateForm = document.getElementById('updateForm');
    const passwordError = document.getElementById('passwordError');
    const updatePassword = document.getElementById('updatePassword');
    const updateConfirmPassword = document.getElementById('updateConfirmPassword');
    const secretKeyElement = document.getElementById('secretKey');
    const lockTimerElement = document.getElementById('lockTimer');

    // التحقق من حالة الحظر
    function checkLockStatus() {
      const lastSecurityChange = localStorage.getItem('lastSecurityChange');
      if (!lastSecurityChange) return false;

      const now = new Date().getTime();
      const lockTime = 48 * 60 * 60 * 1000; // 48 ساعة
      const timePassed = now - parseInt(lastSecurityChange);

      if (timePassed < lockTime) {
        const remaining = lockTime - timePassed;
        const hours = Math.floor(remaining / (60 * 60 * 1000));
        const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
        
        lockTimerElement.innerHTML = `
          System locked for: <br>
          <strong>${hours} hours ${minutes} minutes</strong><br>
          <small>Due to recent security changes</small>
        `;
        return true;
      }
      
      // انتهت مدة الحظر
      localStorage.removeItem('lastSecurityChange');
      return false;
    }

    // تسجيل حدث أمني
    function logSecurityEvent(event) {
      securityLog.push({
        event: event,
        timestamp: new Date().toISOString(),
        ip: currentIP
      });
      localStorage.setItem('securityLog', JSON.stringify(securityLog));
    }

    // توليد مفتاح Google Authenticator
    function generateGoogleAuthSecret() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
      let secret = '';
      for (let i = 0; i < 16; i++) {
        secret += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return secret;
    }

    // التحقق من رمز Google Authenticator
    function verifyGoogleAuthCode(code) {
      return code.length === 6 && /^\d+$/.test(code);
    }

    // التحقق من تطابق كلمات المرور
    updateConfirmPassword.addEventListener('input', function() {
      if (updatePassword.value !== updateConfirmPassword.value) {
        passwordError.style.display = 'block';
      } else {
        passwordError.style.display = 'none';
      }
    });

    // معالجة تسجيل الدخول
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // التحقق من الحظر
      if (checkLockStatus()) {
        loginPage.classList.add('hidden');
        lockPage.classList.remove('hidden');
        return;
      }
      
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      const twoFACode = document.getElementById('login2FA').value;
      
      // فك التشفير والتحقق
      const decryptedUsername = decrypt(encryptedCredentials.username);
      const decryptedPassword = decrypt(encryptedCredentials.password);
      const decryptedTwoFA = decrypt(encryptedCredentials.twoFA);
      
      if (username === decryptedUsername && 
          password === decryptedPassword && 
          twoFACode === decryptedTwoFA) {
        
        // تسجيل الدخول الناجح
        logSecurityEvent('Initial login with default credentials');
        
        // الانتقال إلى صفحة التحديث
        loginPage.classList.add('hidden');
        updatePage.classList.remove('hidden');
        
        // توليد مفتاح جديد
        const secret = generateGoogleAuthSecret();
        secretKeyElement.textContent = secret;
        
      } else {
        alert('Invalid credentials. Please check your username, password and 2FA code.');
        logSecurityEvent('Failed login attempt');
      }
    });

    // معالجة تحديث المعلومات
    updateForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // التحقق من تطابق كلمات المرور
      if (updatePassword.value !== updateConfirmPassword.value) {
        alert('Passwords do not match. Please try again.');
        return;
      }
      
      const newUsername = document.getElementById('updateUsername').value;
      const newPassword = document.getElementById('updatePassword').value;
      const securityQuestion = document.getElementById('securityQuestion').value;
      const securityAnswer = document.getElementById('securityAnswer').value;
      const gauthCode = document.getElementById('gauthCode').value;
      
      // التحقق من رمز Google Authenticator
      if (!verifyGoogleAuthCode(gauthCode)) {
        alert('Invalid Google Authenticator code. Please enter a valid 6-digit code.');
        return;
      }
      
      // حفظ البيانات الجديدة
      users[newUsername] = {
        password: newPassword,
        securityQuestion: securityQuestion,
        securityAnswer: securityAnswer,
        gauthSecret: secretKeyElement.textContent,
        lastUpdate: new Date().toISOString()
      };
      
      localStorage.setItem('coldWalletUsers', JSON.stringify(users));
      
      // تفعيل الحظر لمدة 48 ساعة
      localStorage.setItem('lastSecurityChange', new Date().getTime());
      logSecurityEvent('Security credentials updated - system locked for 48 hours');
      
      // عرض رسالة الحظر
      updatePage.classList.add('hidden');
      lockPage.classList.remove('hidden');
      
      // تحديث عداد الوقت
      updateLockTimer();
    });

    // تحديث عداد الحظر
    function updateLockTimer() {
      if (checkLockStatus()) {
        setTimeout(updateLockTimer, 60000); // تحديث كل دقيقة
      }
    }

    // التحقق الأولي من الحظر
    window.addEventListener('load', function() {
      if (checkLockStatus()) {
        loginPage.classList.add('hidden');
        lockPage.classList.remove('hidden');
        updateLockTimer();
      }
    });

    // حماية إضافية
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'F12' || 
          (e.ctrlKey && e.shiftKey && e.key === 'I') || 
          (e.ctrlKey && e.shiftKey && e.key === 'J') || 
          (e.ctrlKey && e.key === 'u')) {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
